# Лабораторна №6 Simple CRUD. Flask-SQLalchemy

## 1. Інтерфейс сторінки Todo
![image](/screenshots/lab6/lab6_1.png)

## 2. Запити здійснюються за допомогою допоміжних функції в папці helpers

Вміст *database.py*
```python
class HandleTodos(Todo):
    def show(self):
        todos = db.session.query(Todo)
        return todos

    def remove(self, id: int | None):
        todo = Todo.query.filter_by(id=id).first()
        db.session.delete(todo)
        db.session.commit()

    def add(self, name: str):
        task = Todo(task=name)
        db.session.add(task)
        db.session.commit()

    def update(self, id: int):
        task = db.session.query(Todo).filter(Todo.id == id).first()
        task.status = "Completed"
        db.session.commit()
```

Вміст *views.py*
```python
@app.route("/todo")
def todo_list():
    title = "Todo list"
    form = TodoForm()
    handle = database.HandleTodos()
    todo = handle.show()

    return render_template("todo.html", title=title, form=form, todo=todo)


@app.route("/todo/add/", methods=["POST"])
def add_todo():

    try:
        todo = database.HandleTodos()
        todo.add(request.form.get("task"))
        flash("Task have been added to the list", "success")
    except IntegrityError:
        flash("Task with this name already exist", "danger")
        return redirect(url_for("todo_list"))


    return redirect(url_for("todo_list"))


@app.route("/todo/<int:id>/delete/", methods=["POST"])
def remove_todo(id=None):

    if id is not None:
        todo = database.HandleTodos()
        todo.remove(id)
        flash("Item was successfully removed from todo list", "success")

    return redirect(url_for("todo_list"))


@app.route("/todo/<int:id>/update/", methods=["POST"])
def update_todo(id=None):
    todo = database.HandleTodos()
    todo.update(id)
    return redirect(url_for("todo_list"))
```


## 3. Міграція бази даних: додавання поля category
1. flask db init - ініціалізація бази даних
2. flask db migrate -m "added category in the todo list" - виконання міграції
3. flask db upgrade | downgrade - оновлення бази даних(міграція) або відкат до попередньої версії 

Вміст міграції методи upgrade та downgrade для виконання скрипта
```python
"""added category in the todo list

Revision ID: 455e5721ce8d
Revises: 
Create Date: 2023-11-19 13:27:35.318890

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '455e5721ce8d'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('todo', schema=None) as batch_op:
        batch_op.add_column(sa.Column('category', sa.String(), nullable=False))

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('todo', schema=None) as batch_op:
        batch_op.drop_column('category')

    # ### end Alembic commands ###

```